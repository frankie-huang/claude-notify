# =============================================================================
# Claude Code 权限通知 - 环境变量配置
# =============================================================================
# 复制此文件为 .env 并填入实际值
# 脚本会自动从 .env 文件读取配置，无需手动 source
#
# 配置优先级: .env 文件 > 环境变量 > 默认值
# =============================================================================
#
# 配置速查表
# ┌──────────────────────────────┬──────────┬──────────┬──────────┬────────────┐
# │ 配置项                       │ Webhook  │ OpenAPI  │ OpenAPI  │ 默认值     │
# │                              │          │ 单机     │ 分离     │            │
# ├──────────────────────────────┼──────────┼──────────┼──────────┼────────────┤
# │ FEISHU_SEND_MODE             │ 必填     │ 必填     │ 必填     │ webhook    │
# ├──────────────────────────────┼──────────┼──────────┼──────────┼────────────┤
# │ FEISHU_WEBHOOK_URL           │ 必填     │ -        │ -        │ -          │
# │ FEISHU_APP_ID                │ -        │ 必填     │ 网关必填 │ -          │
# │ FEISHU_APP_SECRET            │ -        │ 必填     │ 网关必填 │ -          │
# │ FEISHU_VERIFICATION_TOKEN    │ -        │ 必填     │ 网关必填 │ -          │
# │ FEISHU_GATEWAY_URL           │ -        │ -        │ CB必填   │ -          │
# │ FEISHU_OWNER_ID              │ 可选     │ 必填     │ 必填     │ -          │
# │ FEISHU_CHAT_ID               │ -        │ 可选     │ 可选     │ -          │
# ├──────────────────────────────┼──────────┼──────────┼──────────┼────────────┤
# │ CALLBACK_SERVER_URL          │ 建议     │ 建议     │ 建议     │ localhost  │
# │ CALLBACK_SERVER_PORT         │ 可选     │ 可选     │ 可选     │ 8080       │
# │ PERMISSION_SOCKET_PATH       │ 可选     │ 可选     │ 可选     │ /tmp/...   │
# ├──────────────────────────────┼──────────┼──────────┼──────────┼────────────┤
# │ FEISHU_AT_USER               │ 可选     │ 可选     │ 可选     │ 空         │
# │ PERMISSION_REQUEST_TIMEOUT   │ 可选     │ 可选     │ 可选     │ 600        │
# │ PERMISSION_NOTIFY_DELAY      │ 可选     │ 可选     │ 可选     │ 60         │
# │ CALLBACK_PAGE_CLOSE_DELAY    │ 可选     │ 可选     │ 可选     │ 3          │
# │ STOP_THINKING_MAX_LENGTH     │ 可选     │ 可选     │ 可选     │ 5000       │
# │ STOP_MESSAGE_MAX_LENGTH      │ 可选     │ 可选     │ 可选     │ 5000       │
# ├──────────────────────────────┼──────────┼──────────┼──────────┼────────────┤
# │ CLAUDE_COMMAND               │ 可选     │ 可选     │ 可选     │ claude     │
# ├──────────────────────────────┼──────────┼──────────┼──────────┼────────────┤
# │ VSCODE_URI_PREFIX            │ 可选     │ 可选     │ 可选     │ -          │
# │ ACTIVATE_VSCODE_ON_CALLBACK  │ 可选     │ 可选     │ 可选     │ false      │
# │ VSCODE_SSH_PROXY_PORT        │ 可选     │ 可选     │ 可选     │ -          │
# └──────────────────────────────┴──────────┴──────────┴──────────┴────────────┘
# CB必填 = Callback 服务必填

# =============================================================================
# 一、发送模式（必选）
# =============================================================================

# 发送模式
# - webhook: 使用飞书 Webhook 发送（简单，按钮跳转浏览器）
# - openapi: 使用飞书 OpenAPI 发送（按钮在飞书内响应，需配置事件订阅）
FEISHU_SEND_MODE=webhook

# =============================================================================
# 二、飞书凭证与身份
# =============================================================================
#
# 【重要】OpenAPI 模式需要在飞书开放平台配置事件订阅：
#   1. 进入应用管理 -> 事件订阅 -> 添加事件
#   2. 搜索并订阅「卡片回传交互」(card.action.trigger)
#   3. 配置请求地址为 CALLBACK_SERVER_URL（单机）或飞书网关地址（分离）
#   4. 完成 URL 验证（服务需已启动）
#
# --- 部署方式 ---
# OpenAPI 模式支持两种部署方式：
#
# 【单机部署】所有配置在同一台机器
#   - 配置 FEISHU_APP_ID、FEISHU_APP_SECRET、FEISHU_VERIFICATION_TOKEN、FEISHU_OWNER_ID
#   - 不配置 FEISHU_GATEWAY_URL
#
# 【分离部署】飞书网关与 Callback 服务分离（多实例场景）
#   - 网关服务: 配置 FEISHU_APP_ID、FEISHU_APP_SECRET、FEISHU_VERIFICATION_TOKEN
#   - Callback 服务: 配置 FEISHU_GATEWAY_URL、FEISHU_OWNER_ID
#   - 每个 Callback 服务可以发给不同用户（通过各自的 FEISHU_OWNER_ID）

# --- Webhook 模式 ---
# 飞书 Webhook URL [Webhook 必填]
# 从飞书机器人设置中获取
FEISHU_WEBHOOK_URL=https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx

# --- OpenAPI 模式 — 应用凭证 [单机/网关 必填] ---
# 从飞书开放平台 -> 应用管理 -> 凭证与基础信息 获取
# 分离部署时仅网关服务需要配置
FEISHU_APP_ID=
FEISHU_APP_SECRET=

# Verification Token [单机/网关 必填]
# 从飞书开放平台 -> 应用管理 -> 事件订阅 -> 加密与签名 获取
# 用于验证飞书事件来源 + 生成注册 auth_token
FEISHU_VERIFICATION_TOKEN=

# --- OpenAPI 模式 — 网关（分离部署）---
# 飞书网关地址 [分离部署 Callback 必填]
# 配置后，消息通过飞书网关发送，本机无需配置飞书应用凭证
# 同时用于网关注册功能（注册接口为 {FEISHU_GATEWAY_URL}/register）
FEISHU_GATEWAY_URL=

# --- 消息接收者 ---
# 飞书用户 ID [OpenAPI 必填]
# 必须使用 user_id 格式（纯数字或字母数字组合），服务启动时会校验格式
# 获取方式：https://open.feishu.cn/document/faq/trouble-shooting/how-to-obtain-user-id
# Webhook 模式下可选，仅用于通知 @ 用户
FEISHU_OWNER_ID=

# 飞书群聊 ID [可选]
# 由客户端读取，用于发送消息到指定群聊
# 客户端调用 /feishu/send 时可将 chat_id 作为参数传入
FEISHU_CHAT_ID=

# =============================================================================
# 三、回调服务
# =============================================================================
# 分离部署时，仅 Callback 服务需要配置此部分，网关服务不需要

# 回调服务器外部访问地址 [所有模式建议配置]
# 用于飞书卡片按钮的回调 URL
# 如果使用内网穿透，填写穿透后的公网地址
# 启用网关注册功能时必填
CALLBACK_SERVER_URL=http://localhost:8080

# 回调服务器端口 [可选, 默认 8080]
CALLBACK_SERVER_PORT=8080

# Unix Socket 路径 [可选, 默认 /tmp/claude-permission.sock]
# 用于 hook 脚本与回调服务器之间的通信
PERMISSION_SOCKET_PATH=/tmp/claude-permission.sock

# =============================================================================
# 四、通知与交互行为
# =============================================================================

# 飞书通知 @ 用户配置 [可选]
# 适用于所有飞书通知（权限请求、任务完成等），与发送模式无关
# 支持以下格式:
#   - 空: 默认 @ FEISHU_OWNER_ID 用户
#   - all: @ 所有人
#   - off: 不 @ 任何人
FEISHU_AT_USER=

# 请求超时时间，秒 [可选, 默认 600]
# 用户在此时间内未响应，将回退到终端交互
PERMISSION_REQUEST_TIMEOUT=600

# 权限通知延迟时间，秒 [可选, 默认 60]
# 收到权限请求后延迟指定秒数再发送飞书消息
# 用于避免快速连续请求时的消息轰炸
# 设为 0 表示立即发送
PERMISSION_NOTIFY_DELAY=60

# 回调页面自动关闭时间，秒 [可选, 默认 3]
# 用户点击按钮后，回调页面显示的倒计时秒数
# 建议范围: 1-10 秒
CALLBACK_PAGE_CLOSE_DELAY=3

# Stop 事件思考过程最大长度，字符数 [可选, 默认 5000]
# 设为 0 则不显示思考过程
STOP_THINKING_MAX_LENGTH=5000

# Stop 事件消息最大长度，字符数 [可选, 默认 5000]
# 主 Agent 完成时，发送飞书通知中显示的响应内容最大长度
# 超过此长度会被截断并添加 "..."
STOP_MESSAGE_MAX_LENGTH=5000

# =============================================================================
# 五、Claude 命令
# =============================================================================

# Claude 命令 [可选, 默认 claude]
# 用于继续会话和新建会话功能
#
# 单命令配置（向后兼容）:
#   CLAUDE_COMMAND=claude
#   CLAUDE_COMMAND=claude --setting opus
#
# 多命令配置（列表格式，无需引号）:
#   CLAUDE_COMMAND=[claude, claude --setting opus]
#
# 也兼容 JSON 数组格式:
#   CLAUDE_COMMAND=["claude", "claude --setting opus"]
#
# 配置多个命令后:
#   - 默认使用列表第一个
#   - /new 卡片支持选择
#   - /new --cmd=1 或 /new --cmd=opus 指定使用哪个
#   - /reply --cmd=opus 在回复时指定
#   - 空值或缺失时默认使用 claude
CLAUDE_COMMAND=claude

# =============================================================================
# 六、VSCode 集成（可选，以下两种模式二选一）
# =============================================================================
#
# 【模式一】浏览器跳转模式 - VSCODE_URI_PREFIX
# -----------------------------------------------------------------------------
# 原理：点击飞书按钮后，浏览器回调页面通过 vscode:// 协议链接跳转到 VSCode
# 优点：配置简单，无需额外服务
# 缺点：受浏览器安全策略限制，可能触发跳转确认弹窗
#
# 格式: vscode://vscode-remote/{remote-type}+{host} 或 vscode://file
# 示例:
#   - SSH Remote: vscode://vscode-remote/ssh-remote+myserver
#   - WSL: vscode://vscode-remote/wsl+Ubuntu
#   - 本地: vscode://file (用于本地开发)
#
# 【推荐】VSCode 设置，允许外部应用直接打开（无需确认）：
#   - 本地: settings.json 添加 "security.promptForLocalFileProtocolHandling": false
#   - 远程: settings.json 添加 "security.promptForRemoteFileProtocolHandling": false
#
VSCODE_URI_PREFIX=

# 【模式二】自动激活模式 - ACTIVATE_VSCODE_ON_CALLBACK (推荐)
# -----------------------------------------------------------------------------
# 原理：服务端直接调用命令激活 VSCode 窗口，不依赖浏览器跳转
# 优点：不受浏览器策略限制，体验更流畅
# 缺点：SSH Remote 场景需要配合反向隧道代理
#
# --- 本地开发场景 ---
# 仅配置此项为 true 即可，服务端会执行 'code .' 激活本地 VSCode 窗口
ACTIVATE_VSCODE_ON_CALLBACK=false
#
# --- SSH Remote 远程开发场景 ---
# 结合上述配置，再配置 VSCODE_SSH_PROXY_PORT 即可
# 通过反向 SSH 隧道唤起本地 VSCode 窗口
#
# 使用方法:
#   1. 在本地电脑运行代理服务:
#      python3 src/proxy/vscode_ssh_proxy.py --vps <host> [options]
#        --vps HOST        VPS 的 SSH 地址 (别名如 myserver，或 root@1.2.3.4)
#        --ssh-port PORT   SSH 端口 (默认: 22，使用别名时从 ~/.ssh/config 读取)
#        -p, --port        本地 HTTP 服务端口 (默认: 9527)
#        -r, --remote-port VPS 端远程端口 (默认: 同本地端口)
#   2. 点击飞书按钮会自动唤起本地 VSCode
#
# 注意: VSCODE_SSH_PROXY_PORT 需与代理服务的 --remote-port 参数保持一致 (如 9527)
VSCODE_SSH_PROXY_PORT=
